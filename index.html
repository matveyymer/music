<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ú—É–∑—ã–∫–∞–ª—å–Ω—ã–π –ü–ª–µ–µ—Ä</title>
<style>
:root {
  --accent: #1db954;
  --text: #111;
  --muted: #666;
}

body {
  margin: 0;
  font-family: "SF Pro Display", sans-serif;
  background: #fff;
  color: var(--text);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: space-between;
  height: 100vh;
  overflow: hidden;
}

/* ---- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞ ---- */
.view {
  flex: 1;
  width: 100%;
  max-width: 500px;
  padding: 20px;
  box-sizing: border-box;
  overflow-y: auto;
  display: none;
}

.view.active {
  display: block;
}

/* ---- –°–µ–π—á–∞—Å –∏–≥—Ä–∞–µ—Ç ---- */
.now-playing {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  gap: 16px;
  padding-top: 20px;
}

.cover-wrap {
  width: 280px;
  height: 280px;
  border-radius: 20px;
  overflow: hidden;
  margin-top: 20px;
  box-shadow: 0 12px 40px rgba(0,0,0,0.1);
}

.cover-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

.track-info .title {
  font-size: 20px;
  font-weight: 600;
  margin-top: 10px;
}

.track-info .artist {
  color: var(--muted);
  font-size: 14px;
}

.progress {
  width: 80%;
  height: 6px;
  background: rgba(0,0,0,0.1);
  border-radius: 99px;
  position: relative;
}

.bar {
  height: 100%;
  background: var(--accent);
  border-radius: inherit;
  width: 0%;
}

.time {
  width: 80%;
  display: flex;
  justify-content: space-between;
  font-size: 12px;
  color: var(--muted);
}

.controls {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 30px;
  margin-top: 10px;
}

.controls button {
  background: none;
  border: 2px solid #000;
  border-radius: 50%;
  width: 50px;
  height: 50px;
  font-size: 18px;
  cursor: pointer;
  transition: 0.2s;
}

.controls button:hover {
  background: #f2f2f2;
}

/* ---- –î–æ–∫-–±–∞—Ä ---- */
.dock {
  display: flex;
  justify-content: space-around;
  align-items: center;
  height: 90px;
  width: 100%;
  max-width: 500px;
  border-top: 1px solid rgba(0,0,0,0.1);
  background: #fff;
  position: fixed;
  bottom: 0;
  font-size: 15px;
}

.dock button {
  background: none;
  border: none;
  font-size: 15px;
  cursor: pointer;
  color: var(--muted);
}

.dock button.active {
  color: var(--accent);
  font-weight: 600;
}

/* ---- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ ---- */
.library {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  gap: 20px;
  width: 100%;
  padding: 10px 20px 120px;
  box-sizing: border-box;
}

.track-card {
  display: flex;
  flex-direction: column;
  cursor: pointer;
  align-items: flex-start;
  text-align: left;
}

.track-card .img-wrap {
  position: relative;
  width: 100%;
  padding-top: 100%; /* –∫–≤–∞–¥—Ä–∞—Ç */
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}

.track-card .img-wrap img {
  position: absolute;
  top: 0; left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.track-card .info {
  margin-top: 8px;
  width: 100%;
}

.track-card .title {
  font-size: 15px;
  font-weight: 600;
  color: var(--text);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.track-card .artist {
  font-size: 13px;
  color: var(--muted);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* ---- –ê—Ä—Ç–∏—Å—Ç—ã ---- */
.artists {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
  color: var(--muted);
}
</style>
</head>
<body>

<!-- –í–∫–ª–∞–¥–∫–∞ "–°–µ–π—á–∞—Å –∏–≥—Ä–∞–µ—Ç" -->
<div class="view active" id="nowPlaying">
  <div class="now-playing">
    <div class="cover-wrap">
      <img id="cover" class="cover-img" src="" alt="–û–±–ª–æ–∂–∫–∞">
    </div>
    <div class="track-info">
      <div class="title" id="trackTitle">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞</div>
      <div class="artist" id="trackArtist">–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å</div>
    </div>
    <div class="progress">
      <div class="bar" id="progressBar"></div>
    </div>
    <div class="time">
      <span id="currentTime">0:00</span>
      <span id="totalTime">0:00</span>
    </div>
    <div class="controls">
      <button id="prevBtn">‚èÆ</button>
      <button id="playBtn">‚ñ∫</button>
      <button id="nextBtn">‚è≠</button>
    </div>
  </div>
</div>

<!-- –í–∫–ª–∞–¥–∫–∞ "–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞" -->
<div class="view" id="library">
  <input type="file" id="fileInput" multiple accept="audio/*" style="margin:20px 0;">
  <div class="library" id="libraryList"></div>
</div>

<!-- –í–∫–ª–∞–¥–∫–∞ "–ê—Ä—Ç–∏—Å—Ç—ã" -->
<div class="view" id="artists">
  <div class="artists">–¢—É—Ç –ø–æ—è–≤—è—Ç—Å—è –∞—Ä—Ç–∏—Å—Ç—ã üé§</div>
</div>

<!-- –î–æ–∫-–±–∞—Ä -->
<div class="dock">
  <button id="nowBtn" class="active">–°–µ–π—á–∞—Å –∏–≥—Ä–∞–µ—Ç</button>
  <button id="libBtn">–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞</button>
  <button id="artBtn">–ê—Ä—Ç–∏—Å—Ç—ã</button>
</div>

<audio id="audio"></audio>

<script src="https://cdn.jsdelivr.net/npm/jsmediatags@3.9.7/dist/jsmediatags.min.js"></script>
<script>
const audio = document.getElementById('audio');
const playBtn = document.getElementById('playBtn');
const nextBtn = document.getElementById('nextBtn');
const prevBtn = document.getElementById('prevBtn');
const progressBar = document.getElementById('progressBar');
const currentTime = document.getElementById('currentTime');
const totalTime = document.getElementById('totalTime');
const cover = document.getElementById('cover');
const trackTitle = document.getElementById('trackTitle');
const trackArtist = document.getElementById('trackArtist');
const fileInput = document.getElementById('fileInput');
const libraryList = document.getElementById('libraryList');

const views = {
  nowPlaying: document.getElementById('nowPlaying'),
  library: document.getElementById('library'),
  artists: document.getElementById('artists')
};

let playlist = [];
let index = 0;

function showView(name) {
  for (let key in views) views[key].classList.remove('active');
  views[name].classList.add('active');
  document.querySelectorAll('.dock button').forEach(b => b.classList.remove('active'));
  if (name === 'nowPlaying') nowBtn.classList.add('active');
  if (name === 'library') libBtn.classList.add('active');
  if (name === 'artists') artBtn.classList.add('active');
}

nowBtn.onclick = () => showView('nowPlaying');
libBtn.onclick = () => showView('library');
artBtn.onclick = () => showView('artists');

fileInput.addEventListener('change', e => {
  playlist = Array.from(e.target.files);
  renderLibrary();
});

function renderLibrary() {
  libraryList.innerHTML = '';
  playlist.forEach((file, i) => {
    const card = document.createElement('div');
    card.className = 'track-card';
    const imgWrap = document.createElement('div');
    imgWrap.className = 'img-wrap';
    const img = document.createElement('img');
    img.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUwIiBoZWlnaHQ9IjE1MCIgdmlld0JveD0iMCAwIDE1MCAxNTAiPjxjaXJjbGUgY3g9Ijc1IiBjeT0iNzUiIHI9Ijc1IiBmaWxsPSIjZWVlIi8+PHRleHQgeD0iNzUiIHk9IjgzIiBzdHlsZT0iZmlsbDojY2NjO2ZvbnQtc2l6ZToyNXB4O2ZvbnQtZmFtaWx5OnN5c3RlbS1VSS1tb25vO3RleHQtYW5jaG9yOm1pZGRsZSI+üéµPC90ZXh0Pjwvc3ZnPg==';
    imgWrap.appendChild(img);
    const info = document.createElement('div');
    info.className = 'info';
    const title = document.createElement('div');
    title.className = 'title';
    title.textContent = file.name.replace(/\.[^/.]+$/, '');
    const artist = document.createElement('div');
    artist.className = 'artist';
    artist.textContent = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å';
    info.append(title, artist);
    card.append(imgWrap, info);
    libraryList.append(card);

    window.jsmediatags.read(file, {
      onSuccess: tag => {
        const pic = tag.tags.picture;
        if (pic) {
          const base64 = pic.data.reduce((acc, byte) => acc + String.fromCharCode(byte), '');
          const imageUrl = `data:${pic.format};base64,${btoa(base64)}`;
          img.src = imageUrl;
        }
        if (tag.tags.title) title.textContent = tag.tags.title;
        if (tag.tags.artist) artist.textContent = tag.tags.artist;
      }
    });

    card.addEventListener('click', () => {
      index = i;
      loadTrack(index);
      showView('nowPlaying');
    });
  });
}

function loadTrack(i) {
  const file = playlist[i];
  const url = URL.createObjectURL(file);
  audio.src = url;
  audio.play();
  playBtn.textContent = '‚ùö‚ùö';
  trackTitle.textContent = file.name.replace(/\.[^/.]+$/, '');
  trackArtist.textContent = '‚Äî';
  cover.src = '';

  window.jsmediatags.read(file, {
    onSuccess: tag => {
      if (tag.tags.title) trackTitle.textContent = tag.tags.title;
      if (tag.tags.artist) trackArtist.textContent = tag.tags.artist;
      const pic = tag.tags.picture;
      if (pic) {
        const base64 = pic.data.reduce((acc, byte) => acc + String.fromCharCode(byte), '');
        cover.src = `data:${pic.format};base64,${btoa(base64)}`;
      }
    }
  });
}

playBtn.onclick = () => {
  if (audio.paused) {
    audio.play();
    playBtn.textContent = '‚ùö‚ùö';
  } else {
    audio.pause();
    playBtn.textContent = '‚ñ∫';
  }
};

nextBtn.onclick = () => {
  if (playlist.length) {
    index = (index + 1) % playlist.length;
    loadTrack(index);
  }
};

prevBtn.onclick = () => {
  if (playlist.length) {
    index = (index - 1 + playlist.length) % playlist.length;
    loadTrack(index);
  }
};

audio.addEventListener('timeupdate', () => {
  if (!isNaN(audio.duration)) {
    const progress = (audio.currentTime / audio.duration) * 100;
    progressBar.style.width = progress + '%';
    currentTime.textContent = formatTime(audio.currentTime);
    totalTime.textContent = formatTime(audio.duration);
  }
});

function formatTime(sec) {
  const m = Math.floor(sec / 60);
  const s = Math.floor(sec % 60);
  return `${m}:${s.toString().padStart(2, '0')}`;
}
</script>
</body>
</html>